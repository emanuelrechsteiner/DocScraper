---
url: https://python.langchain.com/assets/js/3c2ae7d0.3406a43b.js
scraped_at: 2025-05-25T18:11:50.577345
title: Untitled
---

```
"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[6858],{27742:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>g,frontMatter:()=>o,metadata:()=>s,toc:()=>l});var a=t(74848),i=t(28453);const o={custom_edit_url:"https://github.com/langchain-ai/langchain/edit/master/docs/docs/versions/migrating_chains/retrieval_qa.ipynb"},r="Migrating from RetrievalQA",s={id:"versions/migrating_chains/retrieval_qa",title:"Migrating from RetrievalQA",description:"The RetrievalQA chain performed natural-language question answering over a data source using retrieval-augmented generation.",source:"@site/docs/versions/migrating_chains/retrieval_qa.md",sourceDirName:"versions/migrating_chains",slug:"/versions/migrating_chains/retrieval_qa",permalink:"/docs/versions/migrating_chains/retrieval_qa",draft:!1,unlisted:!1,editUrl:"https://github.com/langchain-ai/langchain/edit/master/docs/docs/versions/migrating_chains/retrieval_qa.ipynb",tags:[],version:"current",frontMatter:{custom_edit_url:"https://github.com/langchain-ai/langchain/edit/master/docs/docs/versions/migrating_chains/retrieval_qa.ipynb"},sidebar:"docs",previous:{title:"Migrating from RefineDocumentsChain",permalink:"/docs/versions/migrating_chains/refine_docs_chain"},next:{title:"Migrating from StuffDocumentsChain",permalink:"/docs/versions/migrating_chains/stuff_docs_chain"}},c={},l=[{value:"Shared setup",id:"shared-setup",level:2},{value:"Legacy",id:"legacy",level:2},{value:"LCEL",id:"lcel",level:2},{value:"Next steps",id:"next-steps",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components},{Details:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"migrating-from-retrievalqa",children:"Migrating from RetrievalQA"})}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsxs)(n.a,{href:"https://python.langchain.com/api_reference/langchain/chains/langchain.chains.retrieval_qa.base.RetrievalQA.html",children:[(0,a.jsx)(n.code,{children:"RetrievalQA"})," chain"]})," performed natural-language question answering over a data source using retrieval-augmented generation."]}),"\n",(0,a.jsx)(n.p,{children:"Some advantages of switching to the LCEL implementation are:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["Easier customizability. Details such as the prompt and how documents are formatted are only configurable via specific parameters in the ",(0,a.jsx)(n.code,{children:"RetrievalQA"})," chain."]}),"\n",(0,a.jsx)(n.li,{children:"More easily return source documents."}),"\n",(0,a.jsx)(n.li,{children:"Support for runnable methods like streaming and async operations."}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["Now let's look at them side-by-side. We'll use the following ingestion code to load a ",(0,a.jsx)(n.a,{href:"https://lilianweng.github.io/posts/2023-06-23-agent/",children:"blog post by Lilian Weng"})," on autonomous agents into a local vector store:"]}),"\n",(0,a.jsx)(n.h2,{id:"shared-setup",children:"Shared setup"}),"\n",(0,a.jsxs)(n.p,{children:["For both versions, we'll need to load the data with the ",(0,a.jsx)(n.code,{children:"WebBaseLoader"})," document loader, split it with ",(0,a.jsx)(n.code,{children:"RecursiveCharacterTextSplitter"}),", and add it to an in-memory ",(0,a.jsx)(n.code,{children:"FAISS"})," vector store."]}),"\n",(0,a.jsx)(n.p,{children:"We will also instantiate a chat model to use."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:"%pip install --upgrade --quiet langchain-community langchain langchain-openai faiss-cpu beautifulsoup4\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'import os\nfrom getpass import getpass\n\nif "OPENAI_API_KEY" not in os.environ:\n  os.environ["OPENAI_API_KEY"] = getpass()\n'})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'\x3c!--IMPORTS:[{"imported": "WebBaseLoader", "source": "langchain_community.document_loaders", "docs": "https://python.langchain.com/api_reference/community/document_loaders/langchain_community.document_loaders.web_base.WebBaseLoader.html", "title": "Migrating from RetrievalQA"}, {"imported": "FAISS", "source": "langchain_community.vectorstores", "docs": "https://python.langchain.com/api_reference/community/vectorstores/langchain_community.vectorstores.faiss.FAISS.html", "title": "Migrating from RetrievalQA"}, {"imported": "ChatOpenAI", "source": "langchain_openai.chat_models", "docs": "https://python.langchain.com/api_reference/openai/chat_models/langchain_openai.chat_models.base.ChatOpenAI.html", "title": "Migrating from RetrievalQA"}, {"imported": "OpenAIEmbeddings", "source": "langchain_openai.embeddings", "docs": "https://python.langchain.com/api_reference/openai/embeddings/langchain_openai.embeddings.base.OpenAIEmbeddings.html", "title": "Migrating from RetrievalQA"}, {"imported": "RecursiveCharacterTextSplitter", "source": "langchain_text_splitters", "docs": "https://python.langchain.com/api_reference/text_splitters/character/langchain_text_splitters.character.RecursiveCharacterTextSplitter.html", "title": "Migrating from RetrievalQA"}]--\x3e\n# Load docs\nfrom langchain_community.document_loaders import WebBaseLoader\nfrom langchain_community.vectorstores import FAISS\nfrom langchain_openai.chat_models import ChatOpenAI\nfrom langchain_openai.embeddings import OpenAIEmbeddings\nfrom langchain_text_splitters import RecursiveCharacterTextSplitter\n\nloader = WebBaseLoader("https://lilianweng.github.io/posts/2023-06-23-agent/")\ndata = loader.load()\n\n# Split\ntext_splitter = RecursiveCharacterTextSplitter(chunk_size=500, chunk_overlap=0)\nall_splits = text_splitter.split_documents(data)\n\n# Store splits\nvectorstore = FAISS.from_documents(documents=all_splits, embedding=OpenAIEmbeddings())\n\n# LLM\nllm = ChatOpenAI()\n'})}),"\n",(0,a.jsx)(n.h2,{id:"legacy",children:"Legacy"}),"\n",(0,a.jsxs)(t,{open:!0,children:[(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'\x3c!--IMPORTS:[{"imported": "hub", "source": "langchain", "docs": "https://python.langchain.com/api_reference/langchain/hub/langchain.hub.hub.html", "title": "Migrating from RetrievalQA"}, {"imported": "RetrievalQA", "source": "langchain.chains", "docs": "https://python.langchain.com/api_reference/langchain/chains/langchain.chains.retrieval_qa.base.RetrievalQA.html", "title": "Migrating from RetrievalQA"}]--\x3e\nfrom langchain import hub\nfrom langchain.chains import RetrievalQA\n\n# See full prompt at https://smith.langchain.com/hub/rlm/rag-prompt\nprompt = hub.pull("rlm/rag-prompt")\n\nqa_chain = RetrievalQA.from_llm(\n  llm, retriever=vectorstore.as_retriever(), prompt=prompt\n)\n\nqa_chain("What are autonomous agents?")\n'})}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-output",children:"{'query': 'What are autonomous agents?',\n 'result': 'Autonomous agents are LLM-empowered agents capable of handling autonomous design, planning, and performance of complex scientific experiments. These agents can browse the Internet, read documentation, execute code, call robotics experimentation APIs, and leverage other LLMs. They can generate reasoning steps, such as developing a novel anticancer drug, based on requested tasks.'}\n"})})]}),"\n",(0,a.jsx)(n.h2,{id:"lcel",children:"LCEL"}),"\n",(0,a.jsxs)(t,{open:!0,children:[(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'\x3c!--IMPORTS:[{"imported": "hub", "source": "langchain", "docs": "https://python.langchain.com/api_reference/langchain/hub/langchain.hub.hub.html", "title": "Migrating from RetrievalQA"}, {"imported": "StrOutputParser", "source": "langchain_core.output_parsers", "docs": "https://python.langchain.com/api_reference/core/output_parsers/langchain_core.output_parsers.string.StrOutputParser.html", "title": "Migrating from RetrievalQA"}, {"imported": "RunnablePassthrough", "source": "langchain_core.runnables", "docs": "https://python.langchain.com/api_reference/core/runnables/langchain_core.runnables.passthrough.RunnablePassthrough.html", "title": "Migrating from RetrievalQA"}]--\x3e\nfrom langchain import hub\nfrom langchain_core.output_parsers import StrOutputParser\nfrom langchain_core.runnables import RunnablePassthrough\n\n# See full prompt at https://smith.langchain.com/hub/rlm/rag-prompt\nprompt = hub.pull("rlm/rag-prompt")\n\n\ndef format_docs(docs):\n  return "\\n\\n".join(doc.page_content for doc in docs)\n\n\nqa_chain = (\n  {\n    "context": vectorstore.as_retriever() | format_docs,\n    "question": RunnablePassthrough(),\n  }\n  | prompt\n  | llm\n  | StrOutputParser()\n)\n\nqa_chain.invoke("What are autonomous agents?")\n'})}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-output",children:"'Autonomous agents are agents empowered by large language models (LLMs) that can handle autonomous design, planning, and performance of complex tasks such as scientific experiments. These agents can use tools to browse the Internet, read documentation, execute code, call robotics experimentation APIs, and leverage other LLMs for their tasks. The model can come up with reasoning steps when given a specific task, such as developing a novel anticancer drug.'\n"})}),(0,a.jsxs)(n.p,{children:["The LCEL implementation exposes the internals of what's happening around retrieving, formatting documents, and passing them through a prompt to the LLM, but it is more verbose. You can customize and wrap this composition logic in a helper function, or use the higher-level ",(0,a.jsx)(n.a,{href:"https://python.langchain.com/api_reference/langchain/chains/langchain.chains.retrieval.create_retrieval_chain.html",children:(0,a.jsx)(n.code,{children:"create_retrieval_chain"})})," and ",(0,a.jsx)(n.a,{href:"https://python.langchain.com/api_reference/langchain/chains/langchain.chains.combine_documents.stuff.create_stuff_documents_chain.html",children:(0,a.jsx)(n.code,{children:"create_stuff_documents_chain"})})," helper method:"]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'\x3c!--IMPORTS:[{"imported": "hub", "source": "langchain", "docs": "https://python.langchain.com/api_reference/langchain/hub/langchain.hub.hub.html", "title": "Migrating from RetrievalQA"}, {"imported": "create_retrieval_chain", "source": "langchain.chains", "docs": "https://python.langchain.com/api_reference/langchain/chains/langchain.chains.retrieval.create_retrieval_chain.html", "title": "Migrating from RetrievalQA"}, {"imported": "create_stuff_documents_chain", "source": "langchain.chains.combine_documents", "docs": "https://python.langchain.com/api_reference/langchain/chains/langchain.chains.combine_documents.stuff.create_stuff_documents_chain.html", "title": "Migrating from RetrievalQA"}]--\x3e\nfrom langchain import hub\nfrom langchain.chains import create_retrieval_chain\nfrom langchain.chains.combine_documents import create_stuff_documents_chain\n\n# See full prompt at https://smith.langchain.com/hub/langchain-ai/retrieval-qa-chat\nretrieval_qa_chat_prompt = hub.pull("langchain-ai/retrieval-qa-chat")\n\ncombine_docs_chain = create_stuff_documents_chain(llm, retrieval_qa_chat_prompt)\nrag_chain = create_retrieval_chain(vectorstore.as_retriever(), combine_docs_chain)\n\nrag_chain.invoke({"input": "What are autonomous agents?"})\n'})}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-output",children:"{'input': 'What are autonomous agents?',\n 'context': [Document(metadata={'source': 'https://lilianweng.github.io/posts/2023-06-23-agent/', 'title': \"LLM Powered Autonomous Agents | Lil'Log\", 'description': 'Building agents with LLM (large language model) as its core controller is a cool concept. Several proof-of-concepts demos, such as AutoGPT, GPT-Engineer and BabyAGI, serve as inspiring examples. The potentiality of LLM extends beyond generating well-written copies, stories, essays and programs; it can be framed as a powerful general problem solver.\\nAgent System Overview In a LLM-powered autonomous agent system, LLM functions as the agent\u2019s brain, complemented by several key components:', 'language': 'en'}, page_content='Boiko et al. (2023) also looked into LLM-empowered agents for scientific discovery, to handle autonomous design, planning, and performance of complex scientific experiments. This agent can use tools to browse the Internet, read documentation, execute code, call robotics experimentation APIs and leverage other LLMs.\\nFor example, when requested to \"develop a novel anticancer drug\", the model came up with the following reasoning steps:'),\n Document(metadata={'source': 'https://lilianweng.github.io/posts/2023-06-23-agent/', 'title': \"LLM Powered Autonomous Agents | Lil'Log\", 'description': 'Building agents with LLM (large language model) as its core controller is a cool concept. Several proof-of-concepts demos, such as AutoGPT, GPT-Engineer and BabyAGI, serve as inspiring examples. The potentiality of LLM extends beyond generating well-written copies, stories, essays and programs; it can be framed as a powerful general problem solver.\\nAgent System Overview In a LLM-powered autonomous agent system, LLM functions as the agent\u2019s brain, complemented by several key components:', 'language': 'en'}, page_content='Weng, Lilian. (Jun 2023). \u201cLLM-powered Autonomous Agents\u201d. Lil\u2019Log. https://lilianweng.github.io/posts/2023-06-23-agent/.'),\n Document(metadata={'source': 'https://lilianweng.github.io/posts/2023-06-23-agent/', 'title': \"LLM Powered Autonomous Agents | Lil'Log\", 'description': 'Building agents with LLM (large language model) as its core controller is a cool concept. Several proof-of-concepts demos, such as AutoGPT, GPT-Engineer and BabyAGI, serve as inspiring examples. The potentiality of LLM extends beyond generating well-written copies, stories, essays and programs; it can be framed as a powerful general problem solver.\\nAgent System Overview In a LLM-powered autonomous agent system, LLM functions as the agent\u2019s brain, complemented by several key components:', 'language': 'en'}, page_content='Fig. 1. Overview of a LLM-powered autonomous agent system.\\nComponent One: Planning#\\nA complicated task usually involves many steps. An agent needs to know what they are and plan ahead.\\nTask Decomposition#'),\n Document(metadata={'source': 'https://lilianweng.github.io/posts/2023-06-23-agent/', 'title': \"LLM Powered Autonomous Agents | Lil'Log\", 'description': 'Building agents with LLM (large language model) as its core controller is a cool concept. Several proof-of-concepts demos, such as AutoGPT, GPT-Engineer and BabyAGI, serve as inspiring examples. The potentiality of LLM extends beyond generating well-written copies, stories, essays and programs; it can be framed as a powerful general problem solver.\\nAgent System Overview In a LLM-powered autonomous agent system, LLM functions as the agent\u2019s brain, complemented by several key components:', 'language': 'en'}, page_content='Or\\n@article{weng2023agent,\\n title  = \"LLM-powered Autonomous Agents\",\\n author = \"Weng, Lilian\",\\n journal = \"lilianweng.github.io\",\\n year  = \"2023\",\\n month  = \"Jun\",\\n url   = \"https://lilianweng.github.io/posts/2023-06-23-agent/\"\\n}\\nReferences#\\n[1] Wei et al. \u201cChain of thought prompting elicits reasoning in large language models.\u201d NeurIPS 2022\\n[2] Yao et al. \u201cTree of Thoughts: Dliberate Problem Solving with Large Language Models.\u201d arXiv preprint arXiv:2305.10601 (2023).')],\n 'answer': 'Autonomous agents are entities capable of operating independently to perform tasks or make decisions without direct human intervention. In the context provided, autonomous agents empowered by Large Language Models (LLMs) are used for scientific discovery, including tasks like autonomous design, planning, and executing complex scientific experiments.'}\n"})})]}),"\n",(0,a.jsx)(n.h2,{id:"next-steps",children:"Next steps"}),"\n",(0,a.jsxs)(n.p,{children:["Check out the ",(0,a.jsx)(n.a,{href:"/docs/concepts/lcel",children:"LCEL conceptual docs"})," for more background information on the LangChain expression language."]})]})}function g(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>s});var a=t(96540);const i={},o=a.createContext(i);function r(e){const n=a.useContext(o);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),a.createElement(o.Provider,{value:n},e.children)}}}]);
```


